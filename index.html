<!doctype html>
<html lang="en">
<head>
  <!-- v2025-09-30-5 -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>RustWire • Rust+ Companion & Server Tools</title>
  <meta name="description" content="RustWire keeps your Rust server connected with Rust+, wipes, events, and map tools." />
  <link rel="icon" href="./logo.png" type="image/png" />
  <style>
    :root{ --rust-orange:#f0672a; --steel-700:#1e2940; --btn-w:200px; --btn-h:56px; }
    html,body{height:100%}
    body{margin:0;color:#e6e6e6;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif;overflow:hidden;background:#000}

    /* Live wallpaper */
    #bgvid{position:fixed;inset:0;width:100%;height:100%;object-fit:cover;z-index:0;filter:brightness(.9) contrast(1.05) saturate(1.06)}
    .overlay{position:fixed;inset:0;z-index:1;background:linear-gradient(180deg,rgba(0,0,0,.18) 0%,rgba(0,0,0,.5) 60%,rgba(0,0,0,.62) 100%);pointer-events:none}

    /* Top bar + buttons */
    .topbar{position:fixed;z-index:3;top:0;left:0;right:0;display:flex;align-items:center;justify-content:space-between;padding:14px 18px;gap:12px;background:linear-gradient(180deg,rgba(10,15,26,.65),rgba(10,15,26,0))}
    .logo-wrap{display:flex;align-items:center;gap:10px;min-width:0}
    img.logo{height:44px;width:auto;filter:drop-shadow(0 4px 10px rgba(0,0,0,.6));user-select:none}
    .logo-fb{display:none;font-weight:800;color:#fff;font-size:18px;letter-spacing:.5px}
    .btns{display:flex;gap:12px;align-items:center;flex-wrap:wrap}

    .molten{position:relative;display:inline-grid;place-items:center;width:min(var(--btn-w),46vw);
      height:calc(var(--btn-h) * (min(var(--btn-w),46vw)/var(--btn-w)));padding:0;border:none;text-decoration:none;outline:none;cursor:pointer;
      color:#fff;font-weight:900;letter-spacing:.8px;text-transform:uppercase;
      background:linear-gradient(180deg,#3b1f12 0%,#2a130a 60%,#1c0b06 100%);
      border-radius:12px;box-shadow:inset 0 0 10px rgba(0,0,0,.6),0 6px 18px rgba(240,103,42,.28);
      transition:transform .18s ease,filter .28s ease;overflow:hidden;isolation:isolate}
    .molten:hover{transform:translateY(-1px) scale(1.015);filter:drop-shadow(0 8px 18px rgba(240,103,42,.45))}
    .molten::after{content:"";position:absolute;inset:0;border-radius:12px;z-index:1;box-shadow:0 0 18px rgba(240,103,42,.3),inset 0 0 12px rgba(240,103,42,.22);animation:soft-flicker 3.2s ease-in-out infinite;pointer-events:none}
    .molten__lava{--lava1:#ff9a3c;--lava2:#ff6a00;--lava3:#ff3b00;position:absolute;left:-60%;top:-10%;width:220%;height:200%;z-index:0;
      background:radial-gradient(40% 55% at 20% 60%,var(--lava1),transparent 60%),radial-gradient(45% 60% at 50% 70%,var(--lava2),transparent 60%),radial-gradient(35% 50% at 80% 50%,var(--lava3),transparent 60%);
      filter:blur(16px) saturate(140%);mix-blend-mode:screen;opacity:.88;animation:lava-flow 9s linear infinite}
    .molten__label{position:relative;z-index:2;padding:0 16px;text-shadow:0 0 10px rgba(255,120,30,.9),0 0 26px rgba(255,90,0,.4),0 2px 0 rgba(0,0,0,.6);font-size:clamp(12px,2.4vw,16px);white-space:nowrap}
    .molten__drip,.molten__drip::before,.molten__drip::after{position:absolute;bottom:-12px;width:7px;height:7px;border-radius:50%;
      background:radial-gradient(circle at 30% 30%,#ffa34d,#ff6a00 60%,#9a2900 100%);filter:blur(.25px);animation:drip 3.8s linear infinite;opacity:.9}
    .molten__drip{left:24%}.molten__drip::before{content:"";left:220%;animation-delay:.9s}.molten__drip::after{content:"";left:420%;animation-delay:1.8s}
    @keyframes lava-flow{0%{transform:translateX(0) translateY(0) scale(1)}50%{transform:translateX(-28%) translateY(-6%) scale(1.02)}100%{transform:translateX(-56%) translateY(0) scale(1)}}
    @keyframes drip{0%{transform:translateY(0) scale(1);opacity:.95}70%{transform:translateY(22px) scale(1.06);opacity:.86}100%{transform:translateY(34px) scale(.85);opacity:0}}
    @keyframes soft-flicker{0%{box-shadow:0 0 14px rgba(240,103,42,.22),inset 0 0 8px rgba(240,103,42,.13)}50%{box-shadow:0 0 20px rgba(240,103,42,.36),inset 0 0 12px rgba(240,103,42,.2)}100%{box-shadow:0 0 14px rgba(240,103,42,.22),inset 0 0 8px rgba(240,103,42,.13)}}

    /* Bottom-center title card */
    .bottom-center{position:fixed;z-index:2;left:50%;bottom:3vh;transform:translateX(-50%);width:min(860px,calc(100% - 32px));text-align:center}
    .title-card{display:inline-block;background:rgba(17,26,43,.76);border:1px solid var(--steel-700);border-radius:16px;padding:16px 22px;backdrop-filter:blur(6px);box-shadow:0 12px 40px rgba(0,0,0,.5)}
    .title-card h1{margin:0 0 6px;font-size:clamp(22px,5vw,34px);color:var(--rust-orange);letter-spacing:.5px;line-height:1.15}
    .title-card p{margin:0;color:#f0f0f0;font-size:clamp(14px,2.6vw,18px)}
    .link{color:#6cb6ff;text-decoration:none;border-bottom:1px dashed rgba(108,182,255,.5)}

    /* Status badge (shows only after you change portal locally) */
    .status{position:fixed;right:14px;bottom:14px;z-index:3;display:none;gap:8px;align-items:center;background:rgba(17,26,43,.78);border:1px solid #243151;padding:8px 12px;border-radius:12px;backdrop-filter:blur(6px);font-size:14px;user-select:none}
    .dot{width:10px;height:10px;border-radius:50%;background:#aaa;box-shadow:0 0 6px rgba(255,255,255,.25)}
    .dot.on{background:#27d17f;box-shadow:0 0 10px rgba(39,209,127,.65)}
    .dot.off{background:#e05555;box-shadow:0 0 10px rgba(224,85,85,.55)}

    /* Portal chip (always visible; local only) */
    .ownerChip{position:fixed;left:14px;bottom:14px;z-index:4;display:flex;gap:8px;align-items:center;background:rgba(17,26,43,.9);border:1px solid #2a3556;padding:8px 10px;border-radius:12px;backdrop-filter:blur(6px);font-size:13px}
    .ownerChip .mini{opacity:.75}
    .ownerChip button{cursor:pointer;border:none;border-radius:10px;padding:8px 10px;font-weight:800;text-transform:uppercase;letter-spacing:.6px;color:#fff;background:linear-gradient(180deg,#3b1f12 0%,#2a130a 60%,#1c0b06 100%);box-shadow:inset 0 0 10px rgba(0,0,0,.6),0 6px 18px rgba(240,103,42,.28)}

    /* Version badge */
    .ver{position:fixed;left:14px;bottom:54px;z-index:4;opacity:.8;font-size:12px;background:rgba(17,26,43,.7);border:1px solid #2a3556;padding:3px 7px;border-radius:8px}

    @media (max-width:560px){img.logo{height:38px}.topbar{padding:10px 12px}:root{--btn-w:180px;--btn-h:52px}}
  </style>
</head>
<body>
  <!-- Live wallpaper -->
  <video id="bgvid" autoplay muted loop playsinline preload="auto" poster="./logo.png?v=5">
    <source src="./bg.mp4?v=5" type="video/mp4" />
  </video>
  <div class="overlay"></div>

  <!-- Top buttons -->
  <div class="topbar">
    <div class="logo-wrap">
      <img src="./logo.png?v=5" alt="RustWire Logo" class="logo" onerror="this.style.display='none';document.getElementById('logo-fb').style.display='block';" />
      <span id="logo-fb" class="logo-fb">RustWire</span>
    </div>
    <div class="btns">
      <a class="molten" href="https://discord.gg/Ws44MGuKGq" target="_blank" rel="noopener">
        <span class="molten__lava"></span><span class="molten__label">Join Discord</span><span class="molten__drip"></span>
      </a>
      <a class="molten" href="https://discord.com/oauth2/authorize?client_id=1418440547441573900&scope=bot+applications.commands&permissions=8" target="_blank" rel="noopener">
        <span class="molten__lava"></span><span class="molten__label">Add Bot</span><span class="molten__drip"></span>
      </a>
      <!-- Keep "Open Secure Pair" in topbar; removed "Pair Rust+" per request -->
      <a id="securePairBtn" class="molten" href="#" target="_blank" rel="noopener">
        <span class="molten__lava"></span><span class="molten__label">Open Secure Pair</span><span class="molten__drip"></span>
      </a>
    </div>
  </div>

  <!-- Bottom-center card -->
  <div class="bottom-center">
    <div class="title-card">
      <h1>RustWire</h1>
      <p>Stay connected with Rust+, events, wipes, and automation for your Rust server.</p>
      <p style="margin-top:10px">
        <a href="./pair.html?v=5" class="link" id="pairLink">Pair Rust+ with RustWire →</a>
      </p>
    </div>
  </div>

  <!-- Status (shows after you change portal locally) -->
  <div class="status" id="status">
    <span class="dot" id="dot"></span>
    <span id="label">Checking portal…</span>
  </div>

  <!-- Portal chip (local only) -->
  <div class="ownerChip">
    <span class="mini">Portal (local):</span>
    <button id="changePortalBtn">Change</button>
    <a id="clearPortalBtn" class="mini" href="#" title="Reset to default">reset</a>
  </div>

  <div class="ver">v2025-09-30-5</div>

  <script>
    // ====== CONFIG ======
    const DEFAULT_PORTAL_ORIGIN = 'https://middle-dictionary-raised-conferencing.trycloudflare.com';
    const GUILD_ID = '1419192329713094689';
    const CHANNEL_ID = '1422058709835583570';

    // Elements
    const statusBox = document.getElementById('status');
    const dot = document.getElementById('dot');
    const label = document.getElementById('label');
    const secureBtn = document.getElementById('securePairBtn');

    // Portal origin comes from localStorage if set
    const saved = localStorage.getItem('portalOrigin') || '';
    const portalOrigin = saved || DEFAULT_PORTAL_ORIGIN;

    function setSecureLink(){
      const href = `${portalOrigin}/start?guild_id=${encodeURIComponent(GUILD_ID)}&channel_id=${encodeURIComponent(CHANNEL_ID)}`;
      secureBtn.href = href;
      console.log('[RW] Secure Pair URL:', href);
    }

    async function pingPortal(){
      if (saved) statusBox.style.display = 'flex'; // only if you changed it locally
      const PING = `${portalOrigin}/healthz`;
      try{
        const ctrl = new AbortController();
        const t = setTimeout(()=>ctrl.abort(),3500);
        await fetch(PING,{method:'GET',cache:'no-store',mode:'no-cors',signal:ctrl.signal});
        clearTimeout(t);
        dot.classList.remove('off'); dot.classList.add('on');
        label.textContent = 'Portal Online';
      }catch{
        dot.classList.remove('on'); dot.classList.add('off');
        label.textContent = 'Portal Offline';
      }
    }

    // Change/Reset portal URL (local only)
    document.getElementById('changePortalBtn').onclick = () => {
      const cur = localStorage.getItem('portalOrigin') || DEFAULT_PORTAL_ORIGIN;
      const val = prompt('Enter portal URL (e.g. https://example.tld):', cur);
      if (!val) return;
      const trimmed = val.trim();
      if (!/^https?:\/\//i.test(trimmed)) return alert('Please include http(s)://');
      localStorage.setItem('portalOrigin', trimmed);
      location.reload();
    };
    document.getElementById('clearPortalBtn').onclick = (e) => {
      e.preventDefault();
      localStorage.removeItem('portalOrigin');
      location.reload();
    };

    // Video fallback
    const v=document.getElementById('bgvid');
    v?.addEventListener('error',()=>{ v.remove(); document.body.style.background='#0b0f1a'; });

    setSecureLink();
    pingPortal();
    setInterval(pingPortal, 20000);
  </script>
</body>
</html>
